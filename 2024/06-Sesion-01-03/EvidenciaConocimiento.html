<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidencia de conocimiento</title>
</head>
<body>
    <h1>Evidencia de conocimiento</h1>
    <ul>
        <li>Fecha: 01-03-2024</li>
        <li>Hora: 13:00 - 15:00</li>
        <li>Entrega Moodle en el tiempo establecido.</li>
    </ul>

    <h1>Backend</h1>

    <h2>Descripción - crear proyecto con la siguiente estructura:</h2>
    <ul>
        <li>Nombre: PrimerNombrePrimerApellido</li>
        <li>COM: sena</li>
        <li>Dependencias: Spring Boot DevTools, Spring Web, Spring Data JPA, MySQL Driver</li>
        <li>Java: (Sugerida LTS)</li>
        <li>Spring Boot: (Sugerida LTS)</li>
    </ul>

    <h2>Datos de configuración</h2>
    <ul>
        <li>server.port=</li>
        <li>spring.jpa.hibernate.ddl-auto =</li>
        <li>spring.datasource.url = jdbc:mysql:</li>
        <li>spring.datasource.username =</li>
        <li>spring.datasource.password =</li>
    </ul>

    <p><em>Nota: Usar puerto 909+(último dígito de su documento) para el servidor y el 3306 para el motor de base de datos. Ejemplo de ruta driver SQL: jdbc:mysql://localhost:3306/nameBD</em></p>

    <h2>Paquetes de aplicación con respectivos archivos (PascalCase):</h2>
    <h3>Entities</h3>
    <ul>
        <li>Customer</li>
        <li>Product</li>
        <li>CustomerProduct</li>
    </ul>

    <h3>IRepository</h3>
    <ul>
        <li>ICustomerRepository</li>
        <li>IProductRepository</li>
        <li>ICustomerProductRepository</li>
    </ul>

    <h3>IService</h3>
    <ul>
        <li>ICustomerService</li>
        <li>IProductService</li>
        <li>ICustomerProductService</li>
    </ul>

    <h3>Service</h3>
    <ul>
        <li>CustomerService</li>
        <li>ProductService</li>
        <li>CustomerProductService</li>
    </ul>

    <h3>Controller</h3>
    <ul>
        <li>CustomerController</li>
        <li>ProductController</li>
        <li>CustomerProductController</li>
    </ul>

    <h1>Base de datos</h1>

    <h2>Datos de la base de datos</h2>
    <ul>
        <li>User: u342060465_ev_api</li>
        <li>Base de Datos: u342060465_ev_api</li>
        <li>Password = 4=cvqys$vW;R</li>
        <li>IP = 149.100.155.52</li>
    </ul>

    <h2>Necesidad</h2>
    <h3>Entity Customer with the following attributes "customer_document_student":</h3>
    <ul>
        <li>id: BIGINT (primary key, auto-incremental)</li>
        <li>name: VARCHAR(50)</li>
        <li>email: VARCHAR(50)</li>
        <li>phone: VARCHAR(20)</li>
        <li>address: VARCHAR(100)</li>
    </ul>

    <h3>Entity Product with the following attributes "product_document_student":</h3>
    <ul>
        <li>id: BIGINT (primary key, auto-incremental)</li>
        <li>name: VARCHAR(50)</li>
        <li>description: TEXT</li>
    </ul>

    <h3>Entity CustomerProduct representing products associated with a customer:</h3>
    <ul>
        <li>id: BIGINT (primary key, auto-incremental)</li>
        <li>customer_id: BIGINT (foreign key)</li>
        <li>product_id: BIGINT (foreign key, unique constraint)</li>
        <li>balance: DECIMAL(10,2)</li>
    </ul>

    <h2>Audit fields (all entities)</h2>
    <ul>
        <li>state</li>
        <li>createdAt</li>
        <li>updatedAt</li>
        <li>deletedAt</li>
    </ul>

    <h1>API</h1>

    <h2>Datos de la API</h2>
    <ul>
        <li>api/customer</li>
        <li>api/product</li>
        <li>api/customer-product</li>
    </ul>

    <p>Body: raw, JSON</p>
    <p>Métodos:</p>
    <ul>
        <li>GET: FindAll, FindById</li>
        <li>POST: Save</li>
        <li>PUT: Update</li>
        <li>PUT: DeleteLogical</li>
        <li>DELETE: DeleteById</li>
    </ul>

    <h2>Documentación de la API</h2>

    <h3>Colección: customer</h3>
    <p>Carpeta: customer</p>
    <ul>
        <li>GET: FindAll</li>
        <li>GET: FindById</li>
        <li>POST: Save</li>
        <li>PUT: Update</li>
        <li>PUT: DeleteLogical</li>
        <li>DELETE: DeleteById</li>
    </ul>

    <h3>Colección: product</h3>
    <p>Carpeta: product</p>
    <ul>
        <li>GET: FindAll</li>
        <li>GET: FindById</li>
        <li>POST: Save</li>
        <li>PUT: Update</li>
        <li>PUT: DeleteLogical</li>
        <li>DELETE: DeleteById</li>
    </ul>

    <h3>Colección: customer-product</h3>
    <p>Carpeta: customer-product</p>
    <ul>
        <li>GET: FindAll</li>
        <li>GET: FindById</li>
        <li>POST: Save</li>
        <li>PUT: Update</li>
        <li>PUT: DeleteLogical</li>
        <li>DELETE: DeleteById</li>
    </ul>

    <h3>Ejemplo de body</h3>
    <p>Si los atributos de "Departamento" son code y name, de la API api/estate debe ser:</p>
    <pre><code>{
    "code": "12",
    "name": "Huila"
}</code></pre>
    <p>Si los atrubitos de "City" son code, name y estateId, de la API api/city, el body debe ser:</p>
    <pre><code>{
    "code": "121",
    "name": "Neiva",
    "estateId": {
        "id": 1
    }
}</code></pre>

    <h1>Entregar</h1>

    <h2>Backend: Código fuente</h2>
    <h2>Base de datos: Script de creación de la base de datos</h2>
    <h2>Documentación: Documentación de la API con Postman (archivo JSON)</h2>

    <h1>Ejemplo de código</h1>

    <h2>Entity</h2>
    <pre><code>@Entity
@Table(name="materia_estudiante")
public class MateriaEstudiante {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "materia", length = 50)
    private String materia;
    
    @ManyToOne(fetch = FetchType.EAGER, optional = false)
    @JoinColumn(name = "estudiante_id", nullable = false, unique = true)
    public Estudiante estudianteId;

    // Encapsulamiento
    
} 
</code></pre>

    <h2>IRepository</h2>
    <pre><code>@Repository
public interface IMateriaEstudianteRepository extends JpaRepository<MateriaEstudiante, Long>{

}
</code></pre>

    <h2>IService</h2>
    <pre><code>public interface IMateriaEstudianteService {
    List&lt;MateriaEstudiante&gt; all();        
    public Optional&lt;MateriaEstudiante&gt; findById(Long id);        
    public MateriaEstudiante save(MateriaEstudiante materiaEstudiante);        
    public void update(MateriaEstudiante materiaEstudiante, Long id);        
    public void delete(Long id);
}
</code></pre>

    <h2>Servic</h2>
    <pre><code>@Service
public class MateriaEstudianteService implements IMateriaEstudianteService {

    @Autowired
    private IMateriaEstudianteRepository iMateriaEstudianteRepository;
    
    @Override
    public List&lt;MateriaEstudiante&gt; all() {
        return iMateriaEstudianteRepository.findAll();
    }

    @Override
    public Optional&lt;MateriaEstudiante&gt; findById(Long id) {
        return iMateriaEstudianteRepository.findById(id);
    }

    @Override
    public MateriaEstudiante save(MateriaEstudiante materiaEstudiante) {
        return iMateriaEstudianteRepository.save(materiaEstudiante);
    }

    @Override
    public void update(MateriaEstudiante materiaEstudiante, Long id) {
        //validar si existe.            
        Optional&lt;MateriaEstudiante&gt; op = iMateriaEstudianteRepository.findById(id);

        if(op.isEmpty()){
            System.out.println("Dato no encontrado");
        }else{
            //Crear nuevo objeto que va a contener los datos que se van actualizar
            MateriaEstudiante materiaEstudianteUpdate = op.get();
            materiaEstudianteUpdate.setMateria(materiaEstudiante.getMateria());
            materiaEstudianteUpdate.setEstudianteId(materiaEstudiante.getEstudianteId());
            
            //Actualizar el objeto
            iMateriaEstudianteRepository.save(materiaEstudianteUpdate);
        }            
    }

    @Override
    public void delete(Long id) {
        iMateriaEstudianteRepository.deleteById(id);
    }
}
</code></pre>

    <h2>Controller</h2>
    <pre><code>@CrossOrigin(origins = "*")
@RestController
@RequestMapping("v1/api/MateriaEstudiante")
public class MateriaEstudianteController {

    @Autowired
    private IMateriaEstudianteService service;
    
    @GetMapping()
    public List&lt;MateriaEstudiante&gt; all() {
        return service.all();
    }
    
    @GetMapping("{id}")
    public Optional&lt;MateriaEstudiante&gt; show(@PathVariable Long id) {
        return service.findById(id);
    }
    
    @PostMapping
    @ResponseStatus(code = HttpStatus.CREATED)
    public MateriaEstudiante save(@RequestBody MateriaEstudiante materiaEstudiante) {
        return service.save(materiaEstudiante);
    }
    
    @PutMapping("{id}")
    @ResponseStatus(code = HttpStatus.NO_CONTENT)
    public void update(@RequestBody MateriaEstudiante materiaEstudiante, @PathVariable Long id) {
        service.update(materiaEstudiante, id);
    }
    
    @DeleteMapping("{id}")
    @ResponseStatus(code = HttpStatus.NO_CONTENT)
    public void delete(@PathVariable Long id) {
        service.delete(id);
    }
    
}
</code></pre>

    <p><strong>Muchos éxitos en el desarrollo de la prueba.</strong></p>
</body>
</html>
